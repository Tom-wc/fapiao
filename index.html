<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘ç¥¨æ‰“å°å·¥å…·</title>
    <link rel="stylesheet" href="styles.css">
    <!-- PDF.jsåº“ -->
    <script src="vendor/pdf.min.js"></script>
    <!-- JSZipåº“ç”¨äºå¤„ç†OFDæ–‡ä»¶ -->
    <script src="vendor/jszip.min.js"></script>
    <!-- pdf-libåº“ç”¨äºPDFåˆå¹¶æ“ä½œ -->
    <script src="vendor/pdf-lib.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ç»çº¬å…¬å¸å‘ç¥¨æ‰“å°å·¥å…·</h1>
            <p>æ”¯æŒPDFã€å›¾ç‰‡ç­‰å¤šç§æ ¼å¼çš„å‘ç¥¨æ‰“å°</p>
        </header>

        <main>
            <div class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <div class="upload-icon">ğŸ“„</div>
                        <h3>æ‹–æ‹½å‘ç¥¨æ–‡ä»¶åˆ°æ­¤å¤„</h3>
                        <p>æ”¯æŒæ ¼å¼ï¼šPDFã€JPGã€PNGã€GIFã€BMP</p>
                        <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png,.gif,.bmp,.webp" multiple>
                        <button class="upload-btn">
                            é€‰æ‹©å‘ç¥¨æ–‡ä»¶
                        </button>
                    </div>
                </div>
                
                <div class="format-support">
                    <h4>æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼š</h4>
                    <div class="format-list">
                        <span class="format-tag">PDF</span>
                        <span class="format-tag">JPG/JPEG</span>
                        <span class="format-tag">PNG</span>
                        <span class="format-tag">GIF</span>
                        <span class="format-tag">BMP</span>
                        <span class="format-tag">WEBP</span>
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="auto-layout-info">
                    <h3>è‡ªåŠ¨æ’ç‰ˆè¯´æ˜</h3>
                    <p>ç³»ç»Ÿå°†æ ¹æ®å‘ç¥¨æ•°é‡è‡ªåŠ¨æ’ç‰ˆï¼š</p>
                    <ul>
                        <li>1å¼ å‘ç¥¨ï¼šå•å¼ ç½®é¡¶å±…ä¸­ï¼ŒA4ç«–ç‰ˆ</li>
                        <li>2å¼ åŠä»¥ä¸Šå‘ç¥¨ï¼šæ¯é¡µ2å¼ ï¼ŒA4ç«–ç‰ˆ</li>
                    </ul>
                </div>

                <div class="action-buttons">
                    <button id="clearBtn" class="btn btn-secondary">æ¸…ç©ºæ‰€æœ‰</button>
                    <button id="previewBtn" class="btn btn-primary">é¢„è§ˆæ’ç‰ˆ</button>
                    <button id="printBtn" class="btn btn-success">æ‰“å°å‘ç¥¨</button>
                </div>
            </div>

            <div class="processing-status" id="processingStatus" style="display: none;">
                <div class="status-content">
                    <div class="spinner"></div>
                    <span id="statusText">æ­£åœ¨å¤„ç†æ–‡ä»¶...</span>
                </div>
            </div>

            <div class="preview-section" id="previewSection" style="display: none;">
                <h3>æ‰“å°é¢„è§ˆ</h3>
                <div class="preview-pages" id="previewPages">
                    <!-- é¢„è§ˆé¡µé¢å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                </div>
            </div>

            <div class="uploaded-files" id="uploadedFiles">
                <!-- ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </main>
    </div>

    <!-- è°ƒè¯•ä¿¡æ¯æ˜¾ç¤º -->
    <div id="debugInfo" style="display: none; position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; z-index: 10000; max-width: 300px;">
        <div id="debugContent"></div>
        <button onclick="document.getElementById('debugInfo').style.display='none'" style="margin-top: 5px; padding: 2px 8px; background: #666; color: white; border: none; border-radius: 3px; cursor: pointer;">å…³é—­</button>
    </div>

    <script src="script.js"></script>
<script>
(function(){
  // é¢„è§ˆæ ¹å®¹å™¨ï¼ˆå…è®¸å¤šç§å¸¸è§é€‰æ‹©å™¨å…œåº•ï¼‰
  const root =
    document.querySelector('#previewRoot') ||
    document.querySelector('.preview-root') ||
    document.querySelector('.preview-pages')?.closest('.preview-wrapper') ||
    document.querySelector('.preview-pages')?.parentElement ||
    document.body;

  // æ–¹å‘ä¸å¸ƒå±€æ§ä»¶ï¼ˆæ ¹æ®ä½ çš„é¡µé¢æ§ä»¶å‘½åå¯è‡ªåŠ¨åŒ¹é…ï¼‰
  const orientationSelect =
    document.querySelector('#orientationSelect') ||
    document.querySelector('[name="orientation"]') ||
    document.querySelector('select[data-role="orientation"]') ||
    document.querySelector('#orientation');

  const layoutRadios = document.querySelectorAll('[name="layout"]');

  // åŒæ­¥æ–¹å‘ç±»åï¼šorientation-landscape / orientation-portrait
  function applyOrientation(val) {
    const isLandscape = (val === 'landscape' || val === 'æ¨ªå‘');
    root.classList.toggle('orientation-landscape', !!isLandscape);
    root.classList.toggle('orientation-portrait', !isLandscape);
  }

  // åŒæ­¥å¸ƒå±€ç±»åï¼šlayout-single / layout-double / layout-triple / layout-quad
  function applyLayout(val) {
    const all = ['layout-single','layout-double','layout-triple','layout-quad'];
    root.classList.remove(...all);
    // æ”¯æŒä¸­æ–‡ä¸è‹±æ–‡å€¼
    const map = {
      'single':'layout-single','1':'layout-single','å•å¼ ':'layout-single',
      'double':'layout-double','2':'layout-double','åŒå¼ ':'layout-double',
      'triple':'layout-triple','3':'layout-triple','ä¸‰å¼ ':'layout-triple',
      'quad':'layout-quad','4':'layout-quad','å››å¼ ':'layout-quad'
    };
    const cls = map[val] || (val && val.startsWith('layout-') ? val : null);
    if (cls) root.classList.add(cls);
  }

  // äº‹ä»¶ç»‘å®šï¼ˆè‹¥æ§ä»¶å­˜åœ¨ï¼‰
  if (orientationSelect) {
    orientationSelect.addEventListener('change', e => applyOrientation(e.target.value));
  }
  
  layoutRadios.forEach(radio => {
    radio.addEventListener('change', e => {
      if (e.target.checked) {
        applyLayout(e.target.value);
      }
    });
  });

  // åˆå§‹åŒæ­¥ï¼ˆå¦‚æ§ä»¶å­˜åœ¨åˆ™å–å…¶å€¼ï¼Œå¦åˆ™é»˜è®¤A4ç«–ç‰ˆ+å•å¼ ï¼‰
  const initOrientation = orientationSelect?.value || 'portrait';
  const initLayout = document.querySelector('[name="layout"]:checked')?.value || 'single';
  applyOrientation(initOrientation);
  applyLayout(initLayout);

  // å¯é€‰ï¼šæš´éœ²åˆ°å…¨å±€ï¼Œä¾¿äºå¤–éƒ¨è°ƒç”¨è”åŠ¨
  window.__previewSync__ = { applyOrientation, applyLayout };
})();
</script>
</body>
</html>